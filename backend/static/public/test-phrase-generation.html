<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ñ—Ä–∞–∑</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #1a1a1a;
            color: #ffffff;
        }
        .container {
            background-color: #2d2d2d;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        input, textarea {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #555;
            border-radius: 5px;
            background-color: #3d3d3d;
            color: #ffffff;
            box-sizing: border-box;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 0;
        }
        button:hover {
            background-color: #45a049;
        }
        button:disabled {
            background-color: #666;
            cursor: not-allowed;
        }
        .log {
            background-color: #1e1e1e;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #555;
        }
        .error {
            color: #ff6b6b;
        }
        .success {
            color: #51cf66;
        }
        .info {
            color: #74c0fc;
        }
        h1, h2 {
            color: #ffffff;
        }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ñ—Ä–∞–∑</h1>
    
    <div class="container">
        <h2>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞</h2>
        <label for="phrase">–ò—Å—Ö–æ–¥–Ω–∞—è —Ñ—Ä–∞–∑–∞:</label>
        <input type="text" id="phrase" value="fuck you" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ñ—Ä–∞–∑—É –¥–ª—è –æ–±–æ–≥–∞—â–µ–Ω–∏—è">
        
        <label for="keyword">–ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ:</label>
        <input type="text" id="keyword" value="fuck" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ">
        
        <label for="userId">User ID:</label>
        <input type="number" id="userId" value="1" placeholder="ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
        
        <label for="deckId">Deck ID:</label>
        <input type="number" id="deckId" value="1" placeholder="ID –∫–æ–ª–æ–¥—ã">
        
        <label for="backendUrl">Backend URL:</label>
        <input type="text" id="backendUrl" value="http://localhost:8000" placeholder="URL –±—ç–∫–µ–Ω–¥–∞">
        
        <button id="testBtn" onclick="testPhraseGeneration()">üöÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é</button>
        <button onclick="clearLog()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
    </div>
    
    <div class="container">
        <h2>–õ–æ–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</h2>
        <div id="log" class="log"></div>
    </div>
    
    <script>
        function log(message, type = 'info') {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
            logElement.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }
        
        async function testPhraseGeneration() {
            const testBtn = document.getElementById('testBtn');
            testBtn.disabled = true;
            
            try {
                // –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                const phrase = document.getElementById('phrase').value;
                const keyword = document.getElementById('keyword').value;
                const userId = document.getElementById('userId').value;
                const deckId = document.getElementById('deckId').value;
                const backendUrl = document.getElementById('backendUrl').value;
                
                log('üîÑ –ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ñ—Ä–∞–∑...');
                log(`üìù –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: phrase="${phrase}", keyword="${keyword}", userId=${userId}, deckId=${deckId}`);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –±—ç–∫–µ–Ω–¥–∞
                log('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –±—ç–∫–µ–Ω–¥–∞...');
                try {
                    const healthResponse = await fetch(`${backendUrl}/api/health`);
                    if (healthResponse.ok) {
                        const healthData = await healthResponse.json();
                        log(`‚úÖ –ë—ç–∫–µ–Ω–¥ –¥–æ—Å—Ç—É–ø–µ–Ω: ${JSON.stringify(healthData)}`, 'success');
                    } else {
                        log(`‚ö†Ô∏è –ë—ç–∫–µ–Ω–¥ –æ—Ç–≤–µ—á–∞–µ—Ç —Å –∫–æ–¥–æ–º: ${healthResponse.status}`, 'error');
                    }
                } catch (healthError) {
                    log(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±—ç–∫–µ–Ω–¥—É: ${healthError.message}`, 'error');
                    return;
                }
                
                // –§–æ—Ä–º–∏—Ä—É–µ–º URL –∏ —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞
                const url = `${backendUrl}/api/cards/enrich?user_id=${userId}`;
                const requestBody = {
                    original_phrase: phrase,
                    keyword: keyword,
                    deck_id: parseInt(deckId)
                };
                
                log(`üåê URL –∑–∞–ø—Ä–æ—Å–∞: ${url}`);
                log(`üì¶ –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞: ${JSON.stringify(requestBody, null, 2)}`);
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å
                log('üì° –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é...');
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });
                
                log(`üìä –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞: ${response.status} ${response.statusText}`);
                log(`üìã –ó–∞–≥–æ–ª–æ–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞: ${JSON.stringify(Object.fromEntries(response.headers.entries()), null, 2)}`);
                
                // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—Ç–≤–µ—Ç
                const responseText = await response.text();
                log(`üìÑ –°—ã—Ä–æ–π –æ—Ç–≤–µ—Ç: ${responseText}`);
                
                if (response.ok) {
                    try {
                        const data = JSON.parse(responseText);
                        log(`üéâ –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç: ${JSON.stringify(data, null, 2)}`, 'success');
                        
                        if (data.phrases && data.phrases.length > 0) {
                            log(`‚ú® –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ —Ñ—Ä–∞–∑: ${data.phrases.length}`, 'success');
                            data.phrases.forEach((phrase, index) => {
                                log(`  ${index + 1}. "${phrase.original}" -> "${phrase.translation}"`, 'success');
                            });
                            log(`üé® –ó–∞–ø—Ä–æ—Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: "${data.image_query}"`, 'success');
                            log(`üåç –Ø–∑—ã–∫–∏: ${data.source_language} -> ${data.target_language}`, 'success');
                        } else {
                            log('‚ö†Ô∏è –§—Ä–∞–∑—ã –Ω–µ –±—ã–ª–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã', 'error');
                        }
                    } catch (parseError) {
                        log(`‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON: ${parseError.message}`, 'error');
                    }
                } else {
                    log(`‚ùå –û—à–∏–±–∫–∞ API: ${response.status} - ${responseText}`, 'error');
                }
                
            } catch (error) {
                log(`üí• –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: ${error.message}`, 'error');
                log(`üìö Stack trace: ${error.stack}`, 'error');
            } finally {
                testBtn.disabled = false;
                log('üèÅ –¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω.');
            }
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞–µ–º –ª–æ–≥ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            log('üöÄ –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é!');
        };
    </script>
</body>
</html>